var reportId = $(this).attr('data-id');
var editModal = $('#reportEdit');
var editFormWrapper = $('.report-edit__form-wrapper');
editFormWrapper.html('<%= j render partial: 'reports/edit', locals: {report: @report} %>');
editModal.foundation('open');

var reportedAtInput = $(".report_reported_at input");
var datepicker = $(".datepicker-tracer-form").datepicker({
  onSelect: function(dateText) {
    $(this).change();
  }
});

datepicker.datepicker("option", $.datepicker.regional[I18n.currentLocale()]);
datepicker.datepicker("option", "dateFormat", "yy-mm-dd");

$(".datepicker-tracer-form").val(reportedAtInput.val());

$("#reportedAtDatepicker").change(function() {
  reportedAtInput.val(
    $.datepicker.formatDate("yy-mm-dd", datepicker.datepicker("getDate"))
  );
});

var geoloc = $('#geoloc').leafletLocationPicker()
geoloc.on('changeLocation', function (e) {
  $('.report_latitude input').val(e.latlng.lat);
  $('.report_longitude input').val(e.latlng.lng);
});

editModal.on('closed.zf.reveal', function () {
  geoloc.trigger('closeMap');
  $('.leaflet-locpicker-map').remove();
});

$('.leaflet-locpicker-map').css('z-index', 1200)

var informationStatusMessage = $('.simple_form.edit-report .status-message p');
var editReportSubmit = $('.simple_form.edit-report .submit.edit-report');
var editReportLoader = $('.simple_form.edit-report .loader-wrapper.edit-report');

$('.simple_form.edit-report')
.on('ajax:beforeSend', function (e, data, status, xhr) {
  editReportSubmit.addClass('hide');
  editReportLoader.removeClass('hide');
})
.on('ajax:success', function (evt, data, status, xhr) {
  updateStatusMessage(informationStatusMessage, 'success', data.message);
  $('.user-reports__table').DataTable().ajax.reload();
  setTimeout(function(){ editModal.foundation('close'); }, 2000);
})
.on('ajax:error', function (e, data, status, xhr) {
  updateStatusMessage(informationStatusMessage, 'error', data.responseJSON.message);
})
.on('ajax:complete', function (evt, xhr, status, error) {
  editReportSubmit.removeClass('hide');
  editReportLoader.addClass('hide');
});
